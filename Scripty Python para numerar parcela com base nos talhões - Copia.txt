import arcpy
from collections import defaultdict

def autoIncrement(parcela, count):
    parcela = int(parcela)
    count = int(count)
    if count <= 3:
        return 1
    return 1 if parcela % 2 != 0 else 0

def main(fc, campo_index, campo_nm_parcela, campo_contador, campo_manter):
    contagens = defaultdict(int)

    # 1. Contar número de parcelas por Index
    with arcpy.da.SearchCursor(fc, [campo_index]) as cursor:
        for row in cursor:
            contagens[row[0]] += 1

    # 2. Atualizar CONTADOR e MANTER
    with arcpy.da.UpdateCursor(fc, [campo_index, campo_nm_parcela, campo_contador, campo_manter]) as cursor:
        for row in cursor:
            idx = row[0]
            parcela = row[1]
            count = contagens[idx]

            row[2] = count
            row[3] = autoIncrement(parcela, count)
            cursor.updateRow(row)

# Parâmetros do toolbox
if __name__ == '__main__':
    fc = arcpy.GetParameterAsText(0)
    campo_index = "Index"
    campo_nm_parcela = "nm_parcela"
    campo_contador = "CONTADOR"
    campo_manter = "MANTER"
    
    main(fc, campo_index, campo_nm_parcela, campo_contador, campo_manter)
