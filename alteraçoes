output$download_result <- downloadHandler(
  filename = function() {
    name <- input$download_name
    if (is.null(name) || name == "") name <- "parcelas_exportadas"
    paste0("parcelas_", name, ".zip")
  },
  content = function(file) {
    req(values$result_points)
    
    temp_dir <- tempdir()
    shapefile_base <- file.path(temp_dir, input$download_name)
    
    # Escreve os arquivos .shp, .shx, .dbf etc.
    st_write(values$result_points, dsn = shapefile_base, driver = "ESRI Shapefile", delete_layer = TRUE)
    
    # Lista todos os arquivos gerados com o nome base
    shapefile_files <- list.files(temp_dir, pattern = paste0(basename(shapefile_base), "\\."), full.names = TRUE)
    
    # Cria o arquivo .zip final
    zip::zipr(zipfile = file, files = shapefile_files_
