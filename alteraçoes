output$download_result <- downloadHandler(
  filename = function() {
    paste0(input$download_name, ".zip")
  },
  content = function(file) {
    req(values$result_points)
    temp_dir <- tempdir()
    
    # Define o caminho base (sem extensÃ£o)
    shapefile_base <- file.path(temp_dir, input$download_name)
    
    # Cria os arquivos do shapefile no tempdir
    st_write(values$result_points, dsn = shapefile_base, driver = "ESRI Shapefile", delete_layer = TRUE)
    
    # Pega todos os arquivos gerados (.shp, .shx, .dbf, .prj, etc.)
    shapefile_files <- list.files(temp_dir, pattern = paste0(input$download_name, "\\.(shp|shx|dbf|prj|cpg)$"), full.names = TRUE)
    
    # Compacta tudo num .zip
    zip(file, shapefile_files)
  }
)
