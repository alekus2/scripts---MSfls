library(shiny)
library(shinythemes)

ui <- fluidPage(
  tags$head(
    tags$link(rel = "stylesheet", type = "text/css", href = "styles.css"),
    tags$style(HTML("
      #logo {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 100px;
        height: auto;
        z-index: 1000;
      }
      .navbar-default {
        background-color: #0054A4;
      }
      .container {
        width: 100% !important;
        max-width: 100% !important;
        padding-left: 30px !important;
        padding-right: 30px !important;
      }
      .sobre-texto {
        font-family: 'Arial', sans-serif;
        font-size: 16px;
        line-height: 1.5;
        text-align: justify;
      }
      .sobre-texto h2 {
        font-size: 24px;
        margin-bottom: 16px;
      }
      .sobre-texto p {
        margin-bottom: 16px;
      }
    "))
  ),

  tags$img(src = "logo.png", id = "logo"),

  navbarPage("AutoParc - Alocador de Parcelas", id = "main_nav", fluid = TRUE,

    tabPanel("Sobre", icon = icon("info"),
      tags$div(class = "sobre-texto",
        tags$h2("Sobre"),
        tags$p("Ferramenta desenvolvida em Shiny (R) para o lançamento de parcelas com grid da organização, que integra informações de recomendação, shapefile dos talhões e parcelas históricas. Essa aplicação permite aos usuários realizar o lançamento de parcelas de maneira automática e depois exportar o shapefile das parcelas."),
        HTML("<b style='color:red;'>O aplicativo foi meticulosamente desenvolvido para atuar como um instrumento de otimização do processo de lançamento, atuando como um facilitador. No entanto, uma coisa importante a ressaltar é que sua utilização não elimina a necessidade de análises e verificações criteriosas!</b>")
      )
    ),

    tabPanel("Dados", icon = icon("table"),
      sidebarLayout(
        sidebarPanel(
          fileInput("grid_file", "Selecione o shapefile do grid", multiple = TRUE),
          fileInput("talhoes_file", "Selecione o shapefile dos talhões", multiple = TRUE),
          fileInput("parcela_file", "Selecione o shapefile das parcelas históricas", multiple = TRUE),
          fileInput("excel_file", "Selecione o arquivo Excel com a recomendação", accept = c(".xlsx")),
          actionButton("process_button", "Processar", class = "btn-primary")
        ),
        mainPanel(
          uiOutput("progress_ui"),
          verbatimTextOutput("log_output"),
          uiOutput("completed_ui")
        )
      )
    ),

    tabPanel("Resultados", icon = icon("chart-bar"),
      sidebarLayout(
        sidebarPanel(
          selectInput("plot_select", "Selecione o gráfico:", choices = c("Recomendada x Alocada", "Taxa de Alocação")),
          downloadButton("download_shapefile", "Download do Shapefile")
        ),
        mainPanel(
          plotOutput("result_plot"),
          tableOutput("result_table")
        )
      )
    )

  ),

  tags$script(HTML("
    Shiny.addCustomMessageHandler('update_progress', function(percent) {
      $('#progress-bar').css('width', percent + '%');
      $('#progress-bar').text(percent + '%');
    });
    
    Shiny.addCustomMessageHandler('show_completed', function(message) {
      $('#completed-message').show();
    });
    
    Shiny.addCustomMessageHandler('hide_completed', function(message) {
      $('#completed-message').hide();
    });
  "))
)
